
<div class="row">
    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">

          <div class="col-md-12">
            <mat-form-field>
                <mat-label>งบ</mat-label>
                <mat-select (selectionChange)="selectBudget($event)">
                  <mat-option *ngFor="let budjet of budjets" [value]="budjet.value">
                    {{budjet.viewValue}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
          </div>
          <div class="col-md-12">
            <mat-form-field>
                <mat-label>กฟฟ. </mat-label>
                <mat-select (selectionChange)="selectPea($event)">
                  <mat-option *ngFor="let pea of peaname" [value]="pea.peaEng">
                    {{pea.peaCode +" "+pea.peaName}} 
                  </mat-option>
                </mat-select>
              </mat-form-field>
          </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
    <div class="card card-statistics">
      <div class="card-body bg-info">
        <div class="clearfix">
          <div class="float-left">
            <i class="mdi mdi-numeric-1-box text-white icon-lg"></i>
          </div>
          <div class="float-right">
            <p class="mb-0 text-right wrfont">คชจ. หน้างาน คงเหลือ</p>
            <div class="fluid-container">
              <h3 class="font-weight-medium text-right mb-0 wrfont"> {{(this.projectBudget-this.WorkCostApp)/1000000 | number}} ล้านบาท</h3>
            </div>
          </div>
        </div>
        <p class="text-white mt-3 mb-0" style="font-size:120%;">
          <i class="mdi mdi-alert-octagon mr-1" aria-hidden="true"></i> คชจ. หน้างานอนุมัติแล้ว {{this.WorkCostApp/1000000 | number}} ล้านบาท
        </p>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
    <div class="card card-statistics">
      <div class="card-body bg-success">
        <div class="clearfix">
          <div class="float-left">
            <i class="mdi mdi-numeric-2-box text-white icon-lg"></i>
          </div>
          <div class="float-right">
            <p class="mb-0 text-right wrfont">คชจ. หน้างานอนุมัติครั้งนี้</p>
            <div class="fluid-container">
              <h3 class="font-weight-medium text-right mb-0 wrfont">{{this.WorkCost | number}} บาท</h3>
            </div>
          </div>
        </div>
        <p class="text-white mt-3 mb-0" style="font-size:120%;">
          <i class="mdi mdi-alert-octagon mr-1" aria-hidden="true"></i> งานที่อนุมัติครั้งนี้ {{this.nWbs}} งาน
        </p>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 grid-margin stretch-card">
      <div class="card card-statistics">
        <div class="card-body bg-danger">
          <div class="clearfix">
            <div class="float-left">
              <i class="mdi mdi-numeric-3-box text-white icon-lg"></i>
            </div>
            <div class="float-right">
              <p class="mb-0 text-right wrfont">คงค้างรวม</p>
              <div class="fluid-container">
                <h3 class="font-weight-medium text-right mb-0 wrfont">{{this.nwbs}} งาน</h3>
              </div>
            </div>
          </div>
          <p class="text-white mt-3 mb-0" style="font-size:120%;">
            <i class="mdi mdi-alert-octagon mr-1" aria-hidden="true"></i> ใช้ คชจ. หน้างาน {{this.WorkCostPercent | number}}%
          </p>
        </div>
      </div>
    </div>

</div>
<!-----------------------------------Show job------------------------------------------------->
<div class="row">
  <div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <h4 >งานที่ขออนุมัติ</h4>
        <div class="form-group">

            <div class="row">
              <div class="col-md-9">    
                <!---
                <input type="text" class="form-control border-primary" matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
                  --> 
                  <mat-form-field appearance="legacy">
                      <mat-label>ค้นหาข้อมูล</mat-label>
                      <input matInput placeholder="ระบุข้อมูลที่ต้องการค้นหา" matInput (keyup)="applyFilter($event.target.value)">
                    </mat-form-field>
              </div>
              <div class="col-md-3">
                    <a target="_blank" href="http://127.0.0.1/psisservice/wpdf/wpdf.php?filter1={{selBudjet[0]}}&filter2={{selBudjet[1]}}"><button class="btn btn-success mr-2">พิมพ์ใบสรุปงบ</button></a>  
              </div>

          </div>
        </div>
        <div class="col-md-12">
        
            <table class="mat-elevation-z8" mat-table  matSort [dataSource]="dataSource">   

              <ng-container matColumnDef="wbs">
              <th class="table-lg" mat-header-cell *matHeaderCellDef mat-sort-header> wbs </th>
              <td class="table-lg" mat-cell *matCellDef="let jobreq"> <a target="_blank" rel="noopener noreferrer" href={{URL+jobreq.filename}}>{{jobreq.wbs}}</a>  </td>
              </ng-container>

              <ng-container matColumnDef="jobName">
                <th class="table-lg" mat-header-cell *matHeaderCellDef mat-sort-header>ชื่องาน </th>
                <td class="table-lg" mat-cell *matCellDef="let jobreq"> {{jobreq.jobName}} </td>
              </ng-container>

              <ng-container matColumnDef="causeName">
                <th class="table-lg" mat-header-cell *matHeaderCellDef mat-sort-header> สาเหตุการดำเนินการ </th>
                <td class="table-lg" mat-cell *matCellDef="let jobreq">{{jobreq.causeName}}</td>
              </ng-container>

              <ng-container matColumnDef="solveMet">
                <th class="table-lg" mat-header-cell *matHeaderCellDef mat-sort-header> วิธีการแก้ไข </th>
                <td class="table-lg" mat-cell *matCellDef="let jobreq"> {{jobreq.solveMet}} </td>
              </ng-container>

              <ng-container matColumnDef="note">
                  <th class="table-lg" mat-header-cell *matHeaderCellDef mat-sort-header>หมายเหตุ</th>
                  <td class="table-lg" mat-cell *matCellDef="let jobreq"> {{jobreq.note}} </td>
                </ng-container>

              <ng-container matColumnDef="workCostPln">
                  <th class="table-lg" mat-header-cell *matHeaderCellDef mat-sort-header> คชจ.หน้างาน </th>
                  <td class="table-lg" mat-cell *matCellDef="let jobreq"> {{jobreq.workCostPln | number}} </td>
              </ng-container>


                
              <ng-container matColumnDef="user">
                <th class="table-lg" mat-header-cell *matHeaderCellDef>ผู้ขออนุมัติ</th>
                <td class="table-lg" mat-cell *matCellDef="let jobreq"> {{jobreq.user}} </td>
              </ng-container>  

              <ng-container matColumnDef="del">
                <th class="table-lg" mat-header-cell *matHeaderCellDef>  </th>
                <td class="table-lg" mat-cell *matCellDef="let jobreq">
                   <div *ngIf="jobreq.status == 0"><button type="button" class="btn btn-success btn-fw btn-sm" (click)="selWbs(jobreq)"><i class="fa fa-plus-square"></i>อนุมัติ</button></div>
                   <div *ngIf="jobreq.status == 1"><button type="button" class="btn btn-warning btn-fw btn-sm" (click)="delWbs(jobreq)"><i class="fa fa-minus-square"></i>ยกเลิก</button></div>
                </td>
              </ng-container>

              <tr class="table-lg" mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr class="table-lg" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            </table>
          <mat-paginator [pageSizeOptions]="[5, 10, 20]" [pageSize]="10" showFirstLastButtons></mat-paginator>
        </div> 
      </div>
    </div>
  </div>

</div>


<!-----------------------------------Eng job------------------------------------------------->
<div class="row">
    <div class="col-lg-6 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
            <h4 >บันทึกการอนุมัติงาน</h4>
            <form class="example-form">
                <div class="row">
                  <div class="col-md-4"> 
                    <mat-form-field >
                      <input matInput placeholder="เลขที่บันทึก" value="น.2 กวว.(ปร.)-">
                    </mat-form-field>
                  </div>
                 
                  <div class="col-md-4"> 
                    <mat-form-field>
                        <input matInput placeholder="อนุมัติครั้งที่" value="อนุมัติครั้งที่">
                      </mat-form-field>
                  </div>
                  
                  <div class="col-md-4"> 
                    <button type="submit" class="btn btn-success mr-2">บันทึก</button>
                  </div>
                </div>
              </form>
      </div>
    </div>
  </div>

</div>